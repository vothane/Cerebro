(ns cerebro.DBN_test
    (:require [clojure.test :refer :all]
              [cerebro.DeepBeliefNet :refer :all]))

(def dbn
  {
   :sigmoid-layers [{:W [[ 0.14839871643137212 -0.08501163823540675 0.051985421731801734 -0.14855205346676653 -0.044137597789180485 -0.0701731889478024] 
                         [-0.10252046344168927  0.05177738360494413 0.132389904383267    -0.11088185248031387 -0.07047144939818163   0.1342016154235016] 
                         [ 0.11659342725429114 -0.07565106509550569 0.036360063996785374 -0.08211466451905437  0.09155141306199341  -0.16083974594778425]] 
                     :bias [0 0 0]} 
                    {:W [[ 0.1913826375359961  0.19959579863963633  -0.09572763885651328] 
                         [-0.04920529688188052 0.006828221921254152 -0.17304539780927708] 
                         [-0.1938654179145095  0.1287133626717507   -0.06540140494644048]] 
                     :bias [0 0 0]}]  
   :rbm-layers [{:N 6
                 :weights [[ 0.14839871643137212 -0.08501163823540675 0.051985421731801734 -0.14855205346676653 -0.044137597789180485 -0.0701731889478024] 
                     [-0.10252046344168927  0.05177738360494413 0.132389904383267    -0.11088185248031387 -0.07047144939818163   0.1342016154235016] 
                     [ 0.11659342725429114 -0.07565106509550569 0.036360063996785374 -0.08211466451905437  0.09155141306199341  -0.16083974594778425]] 
                 :hbias [0 0 0] 
                 :vbias [0 0 0 0 0 0]} 
                {:N 6 
                 :weights [[ 0.1913826375359961  0.19959579863963633  -0.09572763885651328] 
                     [-0.04920529688188052 0.006828221921254152 -0.17304539780927708] 
                     [-0.1938654179145095  0.1287133626717507   -0.06540140494644048]] 
                 :hbias [0 0 0] 
                 :vbias [0 0 0]}] 
   :log-layers {:W [[0 0 0] [0 0 0]] :bias [0 0]}
  })

(def training-data
  [[1 1 1 0 0 0]
   [1 0 1 0 0 0]
   [1 1 1 0 0 0]
   [0 0 1 1 1 0]
   [0 0 1 1 0 0]
   [0 0 1 1 1 0]])

(def rbm-layer
  [{:N 6 
    :W [[ 0.14142958607095213 -0.09266647551292541 0.0772905918794082  -0.14099685447053134 -0.05349333511775113 -0.09567588113501038] 
        [-0.11125978685596784  0.04268112877616282 0.15627993581732436 -0.10238492086070262 -0.0792493993065675   0.10793664553091545] 
        [ 0.10951416049204235 -0.08316652554536971 0.0632393076839947  -0.07325757153283004  0.08309947084948825 -0.18587906751489314]] 
    :hbias [0.016781592856728436 -0.01693279279285234 -0.0002514603557369245] 
    :vbias [-0.016666666666666666 -0.016666666666666666 0.05 0.016666666666666666 -0.016666666666666666 -0.05]} 
   {:N 6 
    :W [[ 0.2013163973024012  0.1999098782100522   -0.08713722256477963] 
        [-0.04111802863671265 0.005902698514331994 -0.1655674860080091] 
        [-0.1857981810065186  0.12762387538689193  -0.05691015279468117]] 
    :hbias [-0.0029158160119858167 0.0021175844851175204 -0.01586436438320713] 
    :vbias [0.016666666666666666 0 0.016666666666666666]}])

(deftest dbn-pretrain-test
  (testing "DBN pretraining"
    (let [dbn  (DBN-pretrain dbn training-data 1 0.1 1)
          rbms (:rbm-layers dbn)]
      (is (= rbms rbm-layer)))))

